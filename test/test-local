#!/usr/bin/env sh
#
# test add functionality for git plugin
# 
# @author <bprinty@gmail.com>
# ------------------------------------------------


# config
# ------
base=`git rev-parse --show-toplevel`
cache="$base/.git/xfer/cache"
cd "$base/test"
rm "$cache"
touch "$cache"


# testing
# -------
# add
git xfer add test-local test-remote
shasum=`sha1sum test-local | awk '{ print $1 }'`
if [ `cat "$cache" | grep "$shasum" | wc -l` -ne 1 ]; then
    echo 'Fail! Error adding files.'
    exit 1
fi
if [ `cat "$cache" | wc -l` -ne 2 ]; then
    echo 'Fail! Error adding files.'
    exit 1
fi

# list
if [ `git xfer list | wc -l` -ne 2 ]; then
    echo 'Fail! Error listing files.'
    exit 1
fi
git xfer list -v > "$cache.tst"
if [ `diff "$cache.tst" "$cache" | wc -l` -ne 0 ]; then
    echo 'Fail! Error listing verbose.'
    rm "$cache.tst"
    exit 1
fi
rm "$cache.tst"

# remove
git xfer remove test-local test-remote
if [ `cat "$cache" | wc -l` -ne 0 ]; then
    echo 'Fail! Error removing files.'
    exit 1
fi
